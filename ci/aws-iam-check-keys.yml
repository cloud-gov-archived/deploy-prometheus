---
platform: linux
image_resource:
  type: registry-image
  source:
    repository: kennethreitz/pipenv
    registry_mirror:
      host: docker-registry-mirror.app.cloud.gov:443

inputs:
- name: prometheus-config
- name: terraform-prod-com-yml
- name: terraform-prod-gov-yml

run:
  path: sh
  args:
  - -c
  - |
    pipenv install
    pip install boto3
    pipenv run python3 prometheus-config/ci/aws-iam-check-keys/find_stale_keys.py terraform-prod-com-yml/state.yml terraform-prod-gov-yml/state.yml

params:
  AWS_DEFAULT_REGION:
  AWS_ACCESS_KEY_ID:
  AWS_SECRET_ACCESS_KEY:
  IAM_KEYS_DB:
  IAM_KEYS_USER:
  IAM_KEYS_PASSWORD:
  IAM_KEYS_HOST:
  IAM_KEYS_PORT: